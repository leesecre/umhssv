!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("rxjs/Subscription"),require("rxjs/add/operator/debounceTime"),require("rxjs/add/operator/map"),require("rxjs/BehaviorSubject")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Subscription","rxjs/add/operator/debounceTime","rxjs/add/operator/map","rxjs/BehaviorSubject"],factory):factory((global.ng=global.ng||{},global.ng.lock=global.ng.lock||{},global.ng.lock.system=global.ng.lock.system||{}),global.ng.core,global.Rx,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx)}(this,function(exports,_angular_core,rxjs_Subscription,rxjs_add_operator_debounceTime,rxjs_add_operator_map,rxjs_BehaviorSubject){"use strict";function provideLockSystem(enableLogging){return[UtilService,LockManagerService,{provide:ENABLE_LOGGING,useValue:enableLogging||!1}]}var LOCK_STATUS={LOCKED:"LOCKED",UNLOCKED:"UNLOCKED"},__decorate=function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},UtilService=function(){function UtilService(){}return UtilService.prototype.destroySubscription=function(s){if(!this.isNullOrUndefined(s)){for(var arr=this.mapToArray(s),numberOfSubscriptionsRemained=0,_i=0,arr_1=arr;_i<arr_1.length;_i++){var subs=arr_1[_i];!this.isNullOrUndefined(s)&&this.isSubscription(subs)?subs.unsubscribe():numberOfSubscriptionsRemained++}return numberOfSubscriptionsRemained}},UtilService.prototype.cloneObjectWithoutProps=function(value,omitProps){if(void 0===omitProps&&(omitProps=[]),!this.isNullOrUndefined(value)&&this.isObject(value)){var oProps=this.mapToArray(omitProps),retVal={};for(var key in value)-1===oProps.indexOf(key)&&(retVal[key]=value[key]);return retVal}},UtilService.prototype.isNullOrUndefined=function(value){return null===value||void 0===value},UtilService.prototype.mapToArray=function(value){return Array.isArray(value)?value:[value]},UtilService.prototype.isSubscription=function(subs){return subs&&subs.unsubscribe&&this.isInstanceOf(rxjs_Subscription.Subscription,subs)},UtilService.prototype.isFunction=function(f){return this.isInstanceOf(Function,f)},UtilService.prototype.isObject=function(subs){return this.isInstanceOf(Object,subs)},UtilService.prototype.isInstanceOf=function(typeClass,value){return value instanceof typeClass},UtilService.prototype.getId=function(){return this.getFourRandomChars()+this.getFourRandomChars()+"-"+this.getFourRandomChars()+"-"+this.getFourRandomChars()+"-"+this.getFourRandomChars()+"-"+this.getFourRandomChars()+this.getFourRandomChars()+this.getFourRandomChars()},UtilService.prototype.getFourRandomChars=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},UtilService=__decorate([_angular_core.Injectable()],UtilService)}(),RootServiceLocator=function(){function RootServiceLocator(){}return RootServiceLocator}(),__decorate$2=function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata$1=function(k,v){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(k,v)},ENABLE_LOGGING=new _angular_core.OpaqueToken("ENABLE_LOGGING"),NgLockSystemModule=function(){function NgLockSystemModule(appInjector){this.appInjector=appInjector,RootServiceLocator.injector=appInjector}return NgLockSystemModule_1=NgLockSystemModule,NgLockSystemModule.provideLockSystem=function(enableLogging){return void 0===enableLogging&&(enableLogging=!1),{ngModule:NgLockSystemModule_1,providers:provideLockSystem(enableLogging)}},NgLockSystemModule=NgLockSystemModule_1=__decorate$2([_angular_core.NgModule({}),__metadata$1("design:paramtypes",[_angular_core.Injector])],NgLockSystemModule);var NgLockSystemModule_1}(),__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__decorate$1=function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=function(k,v){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(k,v)},__param=function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},LockManagerService=function(){function LockManagerService(enableLogging,_util){this._util=_util,this._managerLock$=new rxjs_BehaviorSubject.BehaviorSubject({}),enableLogging&&this.startLogging()}return LockManagerService.prototype.let=function(){return this._managerLock$},LockManagerService.prototype.lockComponent=function(componentId,lockManager){void 0===lockManager&&(lockManager=!1),this.dispatchStatus(LOCK_STATUS.LOCKED,componentId,lockManager)},LockManagerService.prototype.unlockComponent=function(componentId){this.dispatchStatus(LOCK_STATUS.UNLOCKED,componentId,!1)},LockManagerService.prototype.listenTo=function(components){var _this=this;void 0===components&&(components=[]);var arrayStatus=this._util.mapToArray(components);return 0===arrayStatus.length?this._managerLock$.map(function(managerMap){return _this.getManagerLockedState(managerMap)}):this._managerLock$.map(function(managerMap){return _this.getManagerLockedSubspace(managerMap,arrayStatus)})},LockManagerService.prototype.unListen=function(observables){void 0===observables&&(observables=[]),this._util.destroySubscription(observables)},LockManagerService.prototype.removeComponent=function(cmpId){var latestStatus=this._managerLock$.isStopped?{}:this._managerLock$.getValue();latestStatus&&latestStatus[cmpId]&&(latestStatus=this._util.cloneObjectWithoutProps(latestStatus,[cmpId])),this._managerLock$.next(latestStatus)},LockManagerService.prototype.ngOnDestroy=function(){this._managerLock$.complete()},LockManagerService.prototype.dispatchStatus=function(newStatus,componentId,lockManager){if(void 0===lockManager&&(lockManager=!1),LOCK_STATUS[newStatus]&&componentId){var appLockMap=this._managerLock$.isStopped?{}:this._managerLock$.getValue();appLockMap[componentId]={status:newStatus,lockManager:lockManager},this._managerLock$.next(appLockMap)}},LockManagerService.prototype.getManagerLockedState=function(managerMap){if(!this._util.isObject(managerMap))return!1;for(var cmpId in managerMap)if(managerMap[cmpId]&&managerMap[cmpId].lockManager&&managerMap[cmpId].status===LOCK_STATUS.LOCKED)return!0;return!1},LockManagerService.prototype.getManagerLockedSubspace=function(managerMap,listenedComponents){for(var managerKey in managerMap)if(managerMap[managerKey]&&managerMap[managerKey].status===LOCK_STATUS.LOCKED&&-1!==listenedComponents.indexOf(managerKey))return!0;return!1},LockManagerService.prototype.startLogging=function(){var _this=this;this._managerLock$.subscribe(function(managerMap){var val={};for(var mapKey in managerMap)_this._util.isObject(managerMap[mapKey])&&(val[mapKey]=__assign({},managerMap[mapKey]));console.info("",val)})},LockManagerService=__decorate$1([_angular_core.Injectable(),__param(0,_angular_core.Inject(ENABLE_LOGGING)),__metadata("design:paramtypes",[Boolean,UtilService])],LockManagerService)}(),NgLockComponentBase=function(){function NgLockComponentBase(){this.util=null,this.isLocked$=null,this.isLocked=!1,this.lockManager=null,this._componentId="",this._lockSubscription=null,this._subscriptions=[],this.util=RootServiceLocator.injector.get(UtilService),this.lockManager=RootServiceLocator.injector.get(LockManagerService),this.setComponentId(this.util.getId()),this.setNgOnDestroyHook()}return NgLockComponentBase.prototype.setComponentId=function(componentId){this._componentId=componentId,this.isLocked$=this.lockManager.listenTo(this._componentId).debounceTime(0),this._lockSubscription&&this.unWrapLockSubscription()},NgLockComponentBase.prototype.unWrapLockSubscription=function(){var _this=this;this._lockSubscription&&this.lockManager.unListen(this._lockSubscription),this.isLocked$&&this.isLocked$.subscribe&&(this._lockSubscription=this.isLocked$.subscribe(function(isLocked){return _this.isLocked=isLocked}))},NgLockComponentBase.prototype.busyManager=function(value){void 0===value&&(value=!0),this.busy(value,value)},NgLockComponentBase.prototype.busy=function(value,managerBusy){void 0===value&&(value=!0),void 0===managerBusy&&(managerBusy=!1),value?this.lockManager.lockComponent(this._componentId,managerBusy):this.lockManager.unlockComponent(this._componentId)},NgLockComponentBase.prototype.addSubscription=function(s){this._subscriptions.push(s)},NgLockComponentBase.prototype.cleanupData=function(){this.lockManager.unListen(this._lockSubscription),this.lockManager.removeComponent(this._componentId),this.lockManager.unListen(this._subscriptions)},NgLockComponentBase.prototype.setNgOnDestroyHook=function(){var _this=this,old=function(){};this.util.isFunction(this.ngOnDestroy)&&(old=this.ngOnDestroy.bind(this)),this.ngOnDestroy=function(){old(),_this.cleanupData()}},NgLockComponentBase}();exports.LOCK_STATUS=LOCK_STATUS,exports.UtilService=UtilService,exports.LockManagerService=LockManagerService,exports.NgLockComponentBase=NgLockComponentBase,exports.ENABLE_LOGGING=ENABLE_LOGGING,exports.provideLockSystem=provideLockSystem,exports.NgLockSystemModule=NgLockSystemModule,Object.defineProperty(exports,"__esModule",{value:!0})});